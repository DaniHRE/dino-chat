<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,700;1,500&display=swap"
        rel="stylesheet">
    <script src="teste.js"></script>
</head>

<body>
    <h1>Chat do Dino üê±‚Äçüêâ</h1>
    <div id="conteudo">
    </div>

    <input type="text" placeholder="Digite sua mensagem" id="msg" />

    <script type="module">
        var input = document.getElementById("msg");
        input.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                enviarMSG();
            }
        });

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-app.js";
        import { getDatabase, ref, set, push, remove, onValue } from "https://www.gstatic.com/firebasejs/9.4.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDBDSlqtfLp_QA3d6kmSmRikrJ0p_57Zj0",
            authDomain: "testes-senai.firebaseapp.com",
            projectId: "testes-senai",
            storageBucket: "testes-senai.appspot.com",
            messagingSenderId: "619750994224",
            appId: "1:619750994224:web:b6b00e0b756367997f58f5",
            measurementId: "G-3BRCRBT98N"
        };

        const app = initializeApp(firebaseConfig);

        var db = getDatabase(app);
        const dbRef = ref(db, 'exemplo');

        var meuhtml = "";

        var nomeUsuario = prompt("Digite seu nome");

        if (nomeUsuario == undefined) {
            nomeUsuario = "Random"
        }

        onValue(dbRef, (snapshot) => {
            const data = snapshot.val();
            console.log(data);
            meuhtml = "";
            snapshot.forEach(function (childSnapshot) {
                var key = childSnapshot.key;

                // Exibir Key
                // console.log(key);
                console.log(childSnapshot.val().nome,
                    childSnapshot.val().mensagem,
                    childSnapshot.val().horario);

                if (nomeUsuario === childSnapshot.val().nome) {
                    console.log("Minha Mensagem")
                    meuhtml += '<div class="sended"> <div id="boxMe" class="msg me self conteudo"><b>' + childSnapshot.val().nome + '</i></b><span>' + childSnapshot.val().mensagem + '</span></div></div>';
                }
                else {
                    console.log("Mensagem do Outro")
                    meuhtml += '<div class="stay"> <div id="boxSended" class="msg outros other conteudo"><b>' + childSnapshot.val().nome + '</i></b><span>' + childSnapshot.val().mensagem + '</span></div></div>';
                }

            });
            atualizarHTML();
        });

        function enviarMSG() {

            var datahj = new Date();
            var hora = datahj.getHours() + ":" + datahj.getMinutes() + ":" + datahj.getSeconds()

            push(ref(db, 'exemplo'), {
                nome: nomeUsuario,
                horario: hora,
                mensagem: document.getElementById("msg").value
            });

            document.getElementById("msg").value = "";
        }

        function atualizarHTML() {
            document.getElementById("conteudo").innerHTML = meuhtml
            ajustarScroll();
        }

        function ajustarScroll() {
            console.log("corrirgir scroll");
            var divConteudo = document.getElementById("conteudo");
            divConteudo.scrollTop = divConteudo.scrollHeight;
        }

    </script>
</body>

</html>